namespace = anarchy_start

# Event chain starts with root character scope 

# 000X - Start of the event chain
# 1YXX - Class of the leader type Y
# 11XX - Leader is a criminal
# 12XX - Leader is an activist
# 13XX - Leader is a great leader

# Generally available scopes in the event chain
# scope:original_owner - the original owner of the county
# scope:selected_county - the county that is the target of the event
# scope:leader - the new leader of the county
# scope:previous_gov_type - the previous government type of the leader as a numeric value

anarchy_start.0001 = {
    hidden = yes

    immediate = {
        anarchy_check_character_effect = yes
        
        #save_scope_as = root
        #every_directly_owned_province = {
        #    if = {
        #        limit = {
        #            is_capital_barony = yes
        #            county.county_control < 100
        #        }
        #        scope:root = {
        #            add_gold = 1
        #        }
        #
        #        county = {
        #            save_scope_as = selected_county
        #
        #            holder = {
        #                save_scope_as = original_owner
        #
        #                random_list = {
        #                    pick = 1
        #                    unique = yes
        #                    100 = {
        #                        create_character = {
        #                            template = anarchy_criminal_bandit
        #                            save_scope_as = leader
        #                        }
        #                        trigger_event = anarchy_start.1111
        #                    }
        #                    1 = {
        #                        create_character = {
        #                            template = anarchy_criminal_syndicate
        #                            save_scope_as = leader
        #                        }
        #                        trigger_event = anarchy_start.1121
        #                    }
        #                    1 = {
        #                        create_character = {
        #                            template = anarchy_activist_peasent
        #                            save_scope_as = leader
        #                        }
        #                        trigger_event = anarchy_start.1211
        #                    }
        #                    1 = {
        #                        create_character = {
        #                            template = anarchy_activist_merchant
        #                            save_scope_as = leader
        #                        }
        #                        trigger_event = anarchy_start.1221
        #                    }
        #                    1 = {
        #                        create_character = {
        #                            template = anarchy_scurge
        #                            save_scope_as = leader
        #                        }
        #                        trigger_event = anarchy_start.1311
        #                    }
        #                }
        #            }
        #        }                
        #    }
        #}
    }

    #option = {
    #    name = anarchy_start.0001.a
    #}
}

anarchy_start.1111 = {
    # New leader is a minor bandit
    title = anarchy_start.1111.t
    desc = anarchy_start.1111.desc

    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
                trigger_event = anarchy_start.1180
            }
        }
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        #animation = anger
        animation = war_over_loss
    }

    option = {
        name = anarchy_start.1111.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1121 = {
    # New leader is a criminal syndicate boss
    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
                trigger_event = anarchy_start.1180
            }
        }
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        animation = anger
    }

    option = {
        name = anarchy_start.1121.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1180 = {
    # Criminal type anarchy - government type change event chain
    # root: anarchy leader
    hidden = yes

    immediate = {
        random_list = {
            1 = {
                trigger_event = {
                    id = anarchy_start.1181
                    days = { 30 59 }
                }
            }
            5 = {
                # chance of looping this event
                trigger_event = {
                    id = anarchy_start.1180
                    days = 30 
                }
            }
        }
    }
}

anarchy_start.1181 = {
    # Criminal type anarchy - government change happens

    immediate = {
        scope:leader = {
            if = {
                limit = {
                    capital_barony = {
                        OR = {
                            has_holding_type = tribal_holding
                        }
                    }
                }
                anarchy_end_into_tribal_effect = yes
            }
            else = {
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_feudal_numeric
                    }
                    anarchy_end_into_feudal_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_tribal_numeric
                    }
                    anarchy_end_into_tribal_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_clan_numeric
                    }
                    anarchy_end_into_clan_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_administrative_numeric
                    }
                    anarchy_end_into_administrative_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_republic_numeric
                    }
                    anarchy_end_into_republic_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_theocracy_numeric
                    }
                    anarchy_end_into_theocracy_effect = yes
                }
            }
        }
    }

    option = {
        name = anarchy_start.1181.a
    }
}

anarchy_start.1211 = {
    # New leader is a peasent activist
    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
                trigger_event = anarchy_start.1280
            }
        }

        # random chance to seek co-existance
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        animation = anger
    }

    option = {
        name = anarchy_start.1211.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1221 = {
    # New leader is a merchant activist
    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
                trigger_event = anarchy_start.1280

                add_long_term_gold = 200
            }
        }

        # random chance to seek co-existance
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        animation = anger
    }

    option = {
        name = anarchy_start.1221.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1280 = {
    # Activist type anarchy - government type change event chain
    # root: anarchy leader
    hidden = yes

    immediate = {
        random_list = {
            1 = {
                trigger_event = {
                    id = anarchy_start.1281
                    days = { 30 59 }
                }
            }
            2 = {
                # chance of looping this event
                trigger_event = {
                    id = anarchy_start.1280
                    days = 30 
                }
            }
        }
    }
}

anarchy_start.1281 = {
    # Activist type anarchy - government change happens

    immediate = {
        scope:leader = {
            if = {
                limit = {
                    capital_barony = {
                        OR = {
                            has_holding_type = tribal_holding
                        }
                    }
                }
                anarchy_end_into_tribal_effect = yes
            }
            else = {
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_feudal_numeric
                    }
                    # feudal or republic
                    random_list = {
                        1 = {
                            anarchy_end_into_feudal_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_tribal_numeric
                    }
                    anarchy_end_into_tribal_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_clan_numeric
                    }
                    # clan or republic
                    random_list = {
                        1 = {
                            anarchy_end_into_clan_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_administrative_numeric
                    }
                    anarchy_end_into_administrative_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_republic_numeric
                    }
                    anarchy_end_into_republic_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_theocracy_numeric
                    }
                    random_list = {
                        1 = {
                            anarchy_end_into_theocracy_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
            }
        }
    }

    option = {
        name = anarchy_start.1281.a
    }
}

anarchy_start.1311 = {
    # New leader is a great leader
    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
                trigger_event = anarchy_start.1380
            }
        }
        every_player = {
            if = {
                limit = {
                    realm_to_title_distance_squared = {
                        title = scope:selected_county
                        value < 200000
                    }
                }
                trigger_event = anarchy_start.1319
            }
        }
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        animation = anger
    }

    option = {
        name = anarchy_start.1311.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1319 = {
    # Great leader event notification for players

    theme = war
    left_portrait = scope:leader

    option = {
        name = anarchy_start.1319.a
    }
}

anarchy_start.1321 = {
    # New leader is a scurge
    immediate = {
        scope:selected_county = {
            create_title_and_vassal_change = {
                type = conquest
                save_scope_as = change
                add_claim_on_loss = no
            }

            change_title_holder = {
                holder = scope:leader
                change = scope:change
                take_baronies = yes
            }

            resolve_title_and_vassal_change = scope:change

            scope:leader = {
                change_government = anarchy_government
            }
        }

        every_player = {
            trigger_event = anarchy_start.1329
        }
    }

    left_portrait = scope:leader
    right_portrait = {
        character = scope:original_owner
        animation = anger
    }

    option = {
        name = anarchy_start.1321.a

        scope:leader = {
            start_war = {
                cb = reintegrate_anarchy_casus_belli
                target = scope:original_owner
                target_title = scope:selected_county
            }
        }
    }
}

anarchy_start.1329 = {
    # Scurge event notification for players

    theme = war
    left_portrait = scope:leader

    option = {
        name = anarchy_start.1329.a
    }
}

anarchy_start.1380 = {
    # Great leader type anarchy - government type change event chain
    # root: anarchy leader
    hidden = yes

    immediate = {
        random_list = {
            1 = {
                trigger_event = {
                    id = anarchy_start.1381
                    days = { 30 59 }
                }
            }
            1 = {
                # chance of looping this event
                trigger_event = {
                    id = anarchy_start.1380
                    days = 30 
                }
            }
        }
    }
}

anarchy_start.1381 = {
    # Great leader type anarchy - government change happens

    immediate = {
        scope:leader = {
            if = {
                limit = {
                    capital_barony = {
                        OR = {
                            has_holding_type = tribal_holding
                        }
                    }
                }
                anarchy_end_into_tribal_effect = yes
            }
            else = {
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_feudal_numeric
                    }
                    # feudal or republic
                    random_list = {
                        1 = {
                            anarchy_end_into_feudal_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_tribal_numeric
                    }
                    anarchy_end_into_tribal_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_clan_numeric
                    }
                    # clan or republic
                    random_list = {
                        1 = {
                            anarchy_end_into_clan_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_administrative_numeric
                    }
                    anarchy_end_into_administrative_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_republic_numeric
                    }
                    anarchy_end_into_republic_effect = yes
                }
                if = {
                    limit = {
                        scope:previous_gov_type = government_class_theocracy_numeric
                    }
                    random_list = {
                        1 = {
                            anarchy_end_into_theocracy_effect = yes
                        }
                        1 = {
                            anarchy_end_into_republic_effect = yes
                        }
                    }
                }
            }
        }
    }

    option = {
        name = anarchy_start.1381.a
    }
}

#anarchy_start.8001 = {
#    # Maintenance event: merge nearby bandit groups
#    #hidden = yes
#
#    immediate = {
#        every_neighboring_county = {
#            scope:root = {
#                add_gold = 1
#            }
#            root = {
#                add_gold = 1
#            }
#            add_building = hospices_05
#        }
#        every_neighboring_county = {
#            #limit = {
#            #    holder = {
#            #        has_government = anarchy_government
#            #    }
#            #}
#            # the character with the higher sum of all skills becomes the new leader
#            save_temporary_scope_value_as = {
#                name = total_skill_secondary_leader
#                value = {
#                    value = 0
#                    add = holder.diplomacy
#                    add = holder.martial
#                    add = holder.stewardship
#                    add = holder.intrigue
#                    add = holder.learning
#                    add = holder.prowess
#                }
#            }
#            save_temporary_scope_value_as = {
#                name = total_skill_primary_leader
#                value = {
#                    value = 0
#                    add = scope:leader.diplomacy
#                    add = scope:leader.martial
#                    add = scope:leader.stewardship
#                    add = scope:leader.intrigue
#                    add = scope:leader.learning
#                    add = scope:leader.prowess
#                }
#            }
#            scope:root = {
#                add_gold = 1
#                add_gold = scope:total_skill_primary_leader
#                add_gold = {
#                    value = 0
#                    sub = scope:total_skill_secondary_leader
#                }
#            }
#
#            if = {
#                limit = {
#                    scope:total_skill_primary_leader < scope:total_skill_secondary_leader
#                }
#
#                scope:root = {
#                    every_directly_owned_province = {
#                        limit = {
#                            is_capital_barony = yes
#                        }
#                        county = {
#                            # transfer this county to the secondary leader
#                            # secondary leader is holder of connected county
#                            create_title_and_vassal_change = {
#                                type = conquest
#                                save_scope_as = change
#                                add_claim_on_loss = no
#                            }
#
#                            change_title_holder = {
#                                holder = scope:holder
#                                change = scope:change
#                                take_baronies = yes
#                            }
#
#                            resolve_title_and_vassal_change = scope:change
#                        }
#                    }
#                }
#            }
#            else = {
#                create_title_and_vassal_change = {
#                    type = conquest
#                    save_scope_as = change
#                    add_claim_on_loss = no
#                }
#
#                change_title_holder = {
#                    holder = root
#                    change = scope:change
#                    take_baronies = yes
#                }
#
#                resolve_title_and_vassal_change = scope:change
#            }
#        }
#    }
#
#    option = {
#        name = anarchy_start.8001.a
#    }
#}